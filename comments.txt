По структуре проекта. Непонятно как правилььно - в репе одна структура, в докере другая.
Сделал так:
- файлы миграции в папке /migrations :)
- скрипты для дагов в папке /dags/sql

Структура mart.f_customer_retention плохо понятна из задания. Надеюсь правильно сделал.

Вопрос с идемпотентностью решал через on_conflict.
На stage при повторной загрузке останутся только строки с новыми uniq_id.
Март customer_retention каждую загрузку пересчитывается заново. 
